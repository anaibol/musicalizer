// Generated by CoffeeScript 1.3.1
(function() {
  var path, _;

  _ = require('underscore');

  path = require('path');

  module.exports = function(options) {
    var app, assets, express, templates;
    options.root || (options.root = path.join(__dirname, "..", ".."));
    try {
      _.extend(process.env, require(path.join(options.root, 'env')));
    } catch (err) {

    }
    express = require('express');
    assets = require('connect-assets');
    templates = require('templates');
    require('express-resource');
    require('devcon');
    app = express.createServer();
    app.set('views', "" + options.root + "/views");
    app.set('view engine', 'jade');
    app.use(express.cookieParser());
    app.use(express.bodyParser());
    app.use(express.methodOverride());
    app.use(templates({
      src: "" + options.root + "/views"
    }));
    app.use(assets({
      src: "" + options.root + "/assets"
    }));
    app.use(app.router);
    app.use(express["static"]("" + options.root + "/assets"));
    app.configure('development', function() {
      return app.use(express.errorHandler({
        dumpExceptions: true,
        showStack: true
      }));
    });
    app.configure('production', function() {
      return app.use(express.errorHandler());
    });
    app.dynamicHelpers({
      baseUrl: function(req, res) {
        return 'http://' + req.header('host');
      }
    });
    return app;
  };

}).call(this);
